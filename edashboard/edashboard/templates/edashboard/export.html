{% load staticfiles %}

<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" type="text/css" href="{% static "/edashboard/stylesheet.css" %}">
    <link rel="shortcut icon" href="{% static '/edashboard/images/favicon.ico' %}" />
    <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/jquery-ui.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/jquery/latest/jquery.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css" />
  </head>
  <body>
    {% include "edashboard/header.html" %}
    <div class="exp-container">
      <div id="selector">
        <div id="error-display">
			  </div>
        <h1 id="downloadrep">Download Reports</h1>
        <form id="form-info" >
        <div class="greyell" id="reportrange" style="cursor: pointer; padding: 5px 10px;">
          <i class="fa fa-calendar"></i>&nbsp;
          <span></span> <i class="fa fa-caret-down"></i>
        </div>
          {% include "edashboard/addbuilding.html" %}
          <button id="graphdata" onClick="getData(event)">Graph Data</button>
        </form>
        </div>
      <div class="graph-cont" style=" display:inline-block;">
        <div class="chart-container" style="text-align: -webkit-center;">
          <canvas id="line-chart" width="800" height="450"></canvas>
        </div>
        <button id="Down-button" onClick="downloadData(event)" value="Go Elsewhere" formaction="/elsewhere">Download .CSV</button>
      </div>
    </div>
  </body>
<script>
  {% include "edashboard/scripts/search.js" %}
  {% include "edashboard/scripts/expgraph.js" %}
  {% include "edashboard/scripts/timeRange.js" %}
  {% include "edashboard/scripts/checkefields.js" %}
  //Sets id and name to date value
  var time = document.getElementById("reportrange").getElementsByTagName('span')[0];
  time.setAttribute("id","stringtime");
  time.setAttribute("name","stringtime");
  function downloadData(event){
    event.preventDefault();
    var dataset = [{{usage|safe}}, "date", {{date|safe}}];
    var durl = "{% url 'down_export' data=0%}".replace(/0/, dataset);
    window.location.href = "" + durl.toString() + "";
  }

  function getData(event){
    event.preventDefault();
    var times = ($("span#stringtime").text()).replace(" ","");
    var buildingname = $('#buildingsearchexpcompsearch').val();
    buildingname = getNum(buildingname);
    buildingname = buildingname
    var sensor = $('#select-selected-sens').clone().children().remove().end().text();
    var util = $('#select-selected-util').clone().children().remove().end().text();
    if(util.toString() == ""){
      var details = "build=" + buildingname + "time=" + times + "sensor=" + sensor;
      var destinationUrl = "{% url 'export2' builddata=0 %}".replace(/0/, details.toString());
      window.location.href = "" + destinationUrl.toString() + "";
    }
    if(sensor.toString() == ""){
      var details = "build=" + buildingname + "time=" + times + "util=" + util;
      var destinationUrl = "{% url 'export2' builddata=0 %}".replace(/0/, details.toString());
      window.location.href = "" + destinationUrl.toString() + "";
    }

    //var util = $('#select-selected-util').clone().children().remove().end().text();
    //var myEvent = {'building': buildingname,'time': timestr, 'util': util, 'sensor': sensor};
  }

  function getNum(buildstr) {
    var num = buildstr.split(" ");
    var last = (num[num.length-1]).substring(1);
    return last.substring(0, last.length - 1);
  }

  /* If the user clicks anywhere outside the select box,
  then close all select boxes: */
  document.addEventListener("click", closeAllSelect);
</script>
</html>
